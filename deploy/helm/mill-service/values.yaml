# Mill Service Helm Chart Values
# ================================

# -- Number of replicas
replicaCount: 1

# -- Image configuration
image:
  repository: qpointz/mill-service-samples
  tag: "v0.6.0-dev"
  pullPolicy: IfNotPresent

# -- Image pull secrets for private registries
imagePullSecrets: []
# - name: my-registry-secret

# -- Override chart name
nameOverride: ""
fullnameOverride: ""

# -- Service account configuration
serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

# -- Pod annotations
podAnnotations: {}

# -- Pod labels
podLabels: {}

# -- Pod security context
podSecurityContext: {}
  # fsGroup: 2000

# -- Container security context
securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

# -- Service configuration
service:
  type: ClusterIP
  # HTTP port for REST API and web UI
  httpPort: 8080
  # gRPC port for Mill protocol
  grpcPort: 9099

# -- Resource limits and requests
resources: {}
  # limits:
  #   cpu: 2000m
  #   memory: 2Gi
  # requests:
  #   cpu: 500m
  #   memory: 512Mi

# -- Node selector
nodeSelector: {}

# -- Tolerations
tolerations: []

# -- Affinity rules
affinity: {}

# -- Liveness probe configuration
livenessProbe:
  httpGet:
    path: /actuator/health/liveness
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# -- Readiness probe configuration
readinessProbe:
  httpGet:
    path: /actuator/health/readiness
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# =================================
# Application Configuration
# =================================

# -- Command line arguments passed to mill-service
# Environment variables from secrets will be expanded automatically.
# Example: 
#   args:
#     - "--spring.profiles.active=moneta"
#     - "--spring.ai.openai.api-key=${SPRING_AI_OPENAI_API_KEY}"
#     - "--spring.ai.openai.chat.options.model=gpt-4.1"
# Note: Secrets should be defined in the 'secrets.data' section below.
args: []

# -- Additional environment variables (non-sensitive)
env: []
# - name: JAVA_OPTS
#   value: "-Xmx1g -Xms512m"
# - name: SPRING_PROFILES_ACTIVE
#   value: "prod"

# -- Environment variables from ConfigMap or Secret references
envFrom: []
# - configMapRef:
#     name: my-config
# - secretRef:
#     name: my-secret

# -- Application configuration settings
config:
  # -- Enable ConfigMap-based application.yml (set to false for pre-configured images)
  enabled: true

# -- Application configuration (will be mounted as application.yml)
# This is your main Spring Boot configuration (only used when config.enabled=true)
applicationConfig: |
  logging.level:
    org.springframework.security.web.csrf.CsrfFilter: debug

  management:
    endpoints:
      web:
        exposure:
          include: health, info, prometheus
  spring:
    main:
      web-application-type:servlet
    jpa:
      hibernate:
        ddl-auto: create-drop
    ai:
      chat:
        memory:
          repository:
            jdbc:
              initialize-schema: always
    datasource:
      hikari:
        registerMbeans: true
        maximum-pool-size: 200
        hikari.minimum-idle: 5
        idle-timeout: 600000
        connection-timeout: 30000
        max-lifetime: 1800000
      url: jdbc:h2:mem:moneta
      username: sa
      password: sa

    mcp:
      server:
        enabled: false
        name: moneta-agent
        transport:
          type: http
          endpoint: http://localhost:8080/mcp/task

  mill:
    ai:
      chat:
        memory: in-memory
      nl2sql:
        enable: true
        dialect: H2
    security:
      enable: false
    metadata:
      relations: v2
      annotations: v2
      v2:
        storage:
          type: file
        file:
          path: file:/app/etc/moneta-meta-repository.yaml
    backend:
      provider: jdbc
      connection:
        quoting: DOUBLE_QUOTE
        caseSensitive: true
        unquotedCasing: UNCHANGED
      jdbc:
        url: "jdbc:h2:mem:test;INIT=RUNSCRIPT FROM '/data/moneta/moneta.sql'"
        driver: "org.h2.Driver"
        username: "*"
        password: "*"
        target-schema: "MONETA"
    services:
      grinder:
        enable: true
      ai-nl2data:
        enable: true
      jet-http:
        enable: true
      data-bot:
        enable: false
        prompt-file: file:../../test/datasets/moneta/moneta.prompt
        model-name: gpt-4.1


# =================================
# Secrets Configuration
# =================================
# Secrets are mapped to environment variables.
# For production, consider using External Secrets Operator or Sealed Secrets.

secrets:
  # -- Create a Kubernetes Secret with the values below
  create: true
  # -- Name of existing secret to use (if create is false)
  existingSecretName: ""
  # -- Secret data (key: value pairs become environment variables)
  # Values should be base64 encoded in production or use --set-string
  # These environment variables can be referenced in 'args' using ${VAR_NAME} syntax
  # Example:
  #   data:
  #     SPRING_AI_OPENAI_API_KEY: "sk-..."
  #   args:
  #     - "--spring.ai.openai.api-key=${SPRING_AI_OPENAI_API_KEY}"
  data: {}
    # SPRING_AI_OPENAI_API_KEY: "your-openai-api-key"
    # SPRING_AI_AZURE_OPENAI_API_KEY: "your-azure-openai-key"
    # SPRING_DATASOURCE_PASSWORD: "db-password"

# =================================
# Additional Volumes
# =================================

# -- Extra volumes to mount
extraVolumes: []
# - name: data
#   persistentVolumeClaim:
#     claimName: mill-data-pvc

# -- Extra volume mounts
extraVolumeMounts: []
# - name: data
#   mountPath: /data
